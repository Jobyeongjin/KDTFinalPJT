{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
{% include 'nav.html' %}

<div class="rd-wrap"></div>

<!-- Review-detail -->
<div class="review-detail-wrap">
  <div class="container">

    <!-- review-countent & book-info-->
    <div class="detail-top-wrap">
      
      <!-- Review-countent -->
      <div class="review-content">
        {{ review.content }}
        <!-- review-content-dot -->
        {% if request.user == review.user %}
          <div class="review-content-dot">
            <div class="btn-group dropstart">
              <button type="button" class="dropdown-toggle" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                <i class="fa-solid fa-ellipsis fa-2x"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-lg-end">
                <li><a class="dropdown-item" href="{% url 'reviews:update' review.pk %}">수정하기</a></li>
                <li><a class="dropdown-item" href="{% url 'reviews:delete' review.pk %}" style="color: var(--red-color);">삭제하기</a></li>
              </ul>
            </div>
          </div>
        {% endif %}
      </div>
      <hr>
      <!-- Book-info -->
      <div class="book-info">
        <a href="{% url 'books:detail' book.pk %}">
          <img src="{{ book.bookcover }}" alt="bookcover">
        </a>
        <div class="text">
          <p class="title">{{ book.bookname }}</p>
          <p class="author">{{ book.authors }}</p>
        </div>
      </div>
    </div>

    <!-- review-writer -->
    <div class="detail-bottom-wrap">
      <!-- review-writer -->
      <div class="review-writer">
  
        <!-- review-like -->
        <div class="review-like">
          <div class="count">
            <p>{{ like_count }}</p>
          </div>
          <button class="button">
            <i class="fa-regular fa-heart fa-lg"></i>
          </button>
        </div>
  
        <!-- review-writer-info -->
        <div class="review-writer-info">
          <img src="{{ review.user.user_image }}" alt="writer-image">
          <div class="username">
            <p>{{ review.user.username }}</p>
            <p>{{ review.updated_at }}</p>
          </div>
          <div class="follow">
            <button class="btn btn--white">팔로우</button>
          </div>
        </div>
        
      </div>
      <!-- Comment-create -->
      <div class="comment-create">
        <img src="{{ request.user.user_image }}" alt="my-image">
        <form action="{% url 'reviews:comment_create' review.pk %}" method="post">
          {% csrf_token %}
          <input type="text" name="content" placeholder=" 댓글 남기기" required>
          <button type="submit" class="btn">게시</button>
        </form>
      </div>
      <!-- Comment-list -->
      <div class="comment-list">
        {% for comment in comments %}
        <!-- Comment-item -->
        <div class="comment-item">
          <!-- comment-item-top -->
          <div class="comment-top">
            <div class="writer">
              <img src="{{ comment.user.user_image }}" alt="comment-user-image">
              <div class="">
                <p>{{ comment.user.username }}</p>
                <p>{{ comment.created_at }}</p>
              </div>
            </div>
            <div class="button">
              {% if request.user == comment.user %}
              <a href="{% url 'reviews:comment_delete' review.pk comment.pk %}">
                <span class="material-symbols-outlined me-2" style="font-size: 28px;">delete</span>
              </a>
              {% else %}
              <i class="fa-regular fa-heart fa-lg me-2"></i>
              {% endif %}
            </div>
          </div>
          <!-- comment-item-bottom -->
          <div class="comment-item-bottom">
            <p>{{ comment.content }}</p>
          </div>
        </div>
        {% empty %}
        <div class="my-5" style="color: var(--gray-color);">
          <p>댓글이 없어요...</p>
        </div>
        {% endfor %}
      </div>
    </div>

  </div>
</div>



{% endblock content %}



{% block js %}
  <script>
    // review-detail-background-snow
    function rdCreateSnow() {
      const reviewBg = document.querySelector('.rd-wrap');
      const rdEl = document.createElement("div");
      const bodyHeight = document.body.clientHeight;
      const plusNumber = 50;
      reviewBg.style.height = `${bodyHeight + plusNumber}px`;
      rdEl.classList.add("snow");
      rdEl.style.marginLeft = rdRandomPostion() + "px";
      reviewBg.appendChild(rdEl);
    }
    function rdRandomPostion() {
      return Math.floor(Math.random() * window.innerWidth);
    }
    for (let i = 0; i < 300; i++) {
      rdCreateSnow();
    }
  </script>
{% endblock js %}
  